<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AIXBuilder Auth</title>
  <link href="assets/css/style.css" rel="stylesheet">
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-auth.js"></script>
</head>
<body>
<div style="height: 76vh; display: table;width: 100%; text-align:center;margin-top: 93px;" id="signup-form">
  <h3 style="font-family:Roboto-Regular;font-size: 24px;">Sign Up To AIX Builder</h3>
  <div style="display: table-row">
  <div style="display: table-cell; vertical-align: middle;">
<label class="mdc-text-field mdc-text-field--outlined name-field" style="width: 60vh;">
  <span class="mdc-notched-outline">
    <span class="mdc-notched-outline__leading"></span>
    <span class="mdc-notched-outline__notch">
      <span class="mdc-floating-label" id="name-label">Name</span>
    </span>
    <span class="mdc-notched-outline__trailing"></span>
  </span>
  <input required type="text" class="mdc-text-field__input" id="name-input" aria-labelledby="my-label-id">
</label>
  </div>
  </div>
  <div style="display: table-row">
    <div style="display: table-cell; vertical-align: middle;">
  <label class="mdc-text-field mdc-text-field--outlined email-field" style="width: 60vh;">
  <span class="mdc-notched-outline">
    <span class="mdc-notched-outline__leading"></span>
    <span class="mdc-notched-outline__notch">
      <span class="mdc-floating-label" id="email-label">Email</span>
    </span>
    <span class="mdc-notched-outline__trailing"></span>
  </span>
    <input required type="email" class="mdc-text-field__input" id="email-input" aria-labelledby="my-label-id">
  </label>
  </div>
  </div>
    <div style="display: table-row">
      <div style="display: table-cell; vertical-align: middle;">
        <label class="mdc-text-field mdc-text-field--outlined password-field" style="width: 60vh;">
          <span class="mdc-notched-outline">
            <span class="mdc-notched-outline__leading"></span>
            <span class="mdc-notched-outline__notch">
              <span class="mdc-floating-label" id="password-label">Password</span>
            </span>
            <span class="mdc-notched-outline__trailing"></span>
          </span>
          <input minlength="6" required type="password" class="mdc-text-field__input" id="password-input" aria-labelledby="my-label-id">
        </label>
      </div>
  </div>
  <button disabled class="mdc-button mdc-button--raised" style="width: 192px;" id="signup-btn">
    <div class="mdc-button__ripple"></div>
    <span class="mdc-button__label">Sign Up</span>
  </button>
  <p style="font-family: Roboto-Regular;">Already have an account?</p>
  <u style="font-family: Roboto-Regular;cursor: pointer;" id="alreadyhaveanaccount">Sign In</u>
  </div>
  </div>
<div style="height: 62vh;width: 100%; text-align:center;margin-top: 130px; display: none;"
     id="signin-form">
  <h3 style="font-family:Roboto-Regular;font-size: 24px;">Sign In To AIX Builder</h3>
  <div style="display: table-row">
    <div style="display: table-cell; vertical-align: middle;">
      <label class="mdc-text-field mdc-text-field--outlined signin-email-field" style="width: 60vh;">
  <span class="mdc-notched-outline">
    <span class="mdc-notched-outline__leading"></span>
    <span class="mdc-notched-outline__notch">
      <span class="mdc-floating-label" id="signin-email-label">Email</span>
    </span>
    <span class="mdc-notched-outline__trailing"></span>
  </span>
        <input required type="email" class="mdc-text-field__input" id="signin-email-input" aria-labelledby="my-label-id">
      </label>
    </div>
  </div>
  <div style="display: table-row">
    <div style="display: table-cell; vertical-align: middle;">
      <label class="mdc-text-field mdc-text-field--outlined signin-password-field" style="width: 60vh;">
  <span class="mdc-notched-outline">
    <span class="mdc-notched-outline__leading"></span>
    <span class="mdc-notched-outline__notch">
      <span class="mdc-floating-label" id="signin-password-label">Password</span>
    </span>
    <span class="mdc-notched-outline__trailing"></span>
  </span>
        <input minlength="6" required type="password" class="mdc-text-field__input" id="signin-password-input" aria-labelledby="my-label-id">
      </label>
    </div>
  </div>
  <button disabled class="mdc-button mdc-button--raised" style="width: 192px;" id="signin-btn">
    <div class="mdc-button__ripple"></div>
    <span class="mdc-button__label">Sign In</span>
  </button>
  <p style="font-family: Roboto-Regular;">Don't have an account?</p>
  <u style="font-family: Roboto-Regular;cursor: pointer;" id="donthaveanaccount">Sign Up</u>
</div>
</div>
<div class="mdc-snackbar">
  <div class="mdc-snackbar__surface" role="status" aria-relevant="additions">
    <div class="mdc-snackbar__label" aria-atomic="false">
      Error
    </div>
  </div>
</div>
<script>
  var isSigningUp = false;
  var firebaseConfig = {
    apiKey: "AIzaSyCPEQpKKzAxKREl7enSSSSWTc5UG3DftBc",
    authDomain: "aixbuilder.firebaseapp.com",
    projectId: "aixbuilder",
    storageBucket: "aixbuilder.appspot.com",
    messagingSenderId: "964934130307",
    appId: "1:964934130307:web:73fcb8e2382f76cb4659b6",
    measurementId: "G-8Q89DSMK8F"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  var PATH_TO_BUILDER = "../client/index.html";
  console.log(firebase.auth().currentUser);
  firebase.auth().onAuthStateChanged(function(user) {
  if (user && !isSigningUp) {
    location.replace(PATH_TO_BUILDER);
  }
});
  new mdc.textField.MDCTextField(document.querySelector('.email-field'));
  new mdc.textField.MDCTextField(document.querySelector('.name-field'));
  new mdc.textField.MDCTextField(document.querySelector('.password-field'));
  new mdc.textField.MDCTextField(document.querySelector('.signin-email-field'));
  new mdc.textField.MDCTextField(document.querySelector('.signin-password-field'));
      document.querySelectorAll('.mdc-button').forEach(
    function(ele) {
        mdc.ripple.MDCRipple.attachTo(ele);
    });
    document.getElementById("alreadyhaveanaccount").addEventListener("click", function() {
      document.getElementById("signin-form").style.display = 'table';
      document.getElementById("signup-form").style.display = 'none';
    });
    document.getElementById("donthaveanaccount").addEventListener("click", function() {
      document.getElementById("signup-form").style.display = 'table';
      document.getElementById("signin-form").style.display = 'none';
    });
    document.getElementById("signup-btn").addEventListener("click", function() {
      isSigningUp = true;
      firebase.auth().createUserWithEmailAndPassword(document.getElementById("email-input").value,
      document.getElementById("password-input").value)
        .then((userCredential) => {
          // Signed in
          var user = userCredential.user;
          user.updateProfile({
            displayName: document.getElementById("name-input").value,
            photoURL: "https://ui-avatars.com/api/?name=" + document.getElementById("name-input").value + "&rounded=true"
          }).then(() => {
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "https://aixbuilder.000webhostapp.com/signup.php", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function() {
              if (xhr.readyState == 4 && xhr.status == 200) {
                location.replace(PATH_TO_BUILDER);
              } else if (xhr.status != 200) {
                var snackbar = mdc.snackbar.MDCSnackbar.attachTo(document.querySelector('.mdc-snackbar'));
                snackbar.labelText = xhr.responseText;
                snackbar.open();
              }
            }
            xhr.send("key=aixbuildr@@584390&" +
                "uid=" + user.uid + "&" +
                "name=" + user.displayName+ "&" +
                "email=" + user.email + "&" +
                "photoUrl=" + user.photoURL);
          }).catch((error) => {
            var errorMessage = error.message;
            var snackbar = mdc.snackbar.MDCSnackbar.attachTo(document.querySelector('.mdc-snackbar'));
            snackbar.labelText = errorMessage;
            snackbar.open();
          });
        })
        .catch((error) => {
          var errorCode = error.code;
          var errorMessage = error.message;
          var snackbar = mdc.snackbar.MDCSnackbar.attachTo(document.querySelector('.mdc-snackbar'));
          snackbar.labelText = errorMessage;
          snackbar.open();
        });
    });
    document.getElementById("signin-btn").addEventListener("click", function() {
      firebase.auth().signInWithEmailAndPassword(document.getElementById("signin-email-input").value,
      document.getElementById("signin-password-input").value)
        .then((userCredential) => {
          // handled by onAuthStateChanged method
        })
        .catch((error) => {
          var errorCode = error.code;
          var errorMessage = error.message;
          var snackbar = mdc.snackbar.MDCSnackbar.attachTo(document.querySelector('.mdc-snackbar'));
          snackbar.labelText = errorMessage;
          snackbar.open();
        });
    });
    var nameInput = document.getElementById("name-input");
    var signup = document.getElementById("signup-btn");
    nameInput.addEventListener("input", function() {
      if (!isAllInputsValid()) {
        signup.setAttribute("disabled", "disabled");
      } else {
        signup.removeAttribute("disabled");
      }
    });
    var emailInput = document.getElementById("email-input");
    emailInput.addEventListener("input", function() {
      if (!isAllInputsValid()) {
        signup.setAttribute("disabled", "disabled");
      } else {
        signup.removeAttribute("disabled");
      }
    });
    var passwordInput = document.getElementById("password-input");
    passwordInput.addEventListener("input", function() {
      if (!isAllInputsValid()) {
        signup.setAttribute("disabled", "disabled");
      } else {
        signup.removeAttribute("disabled");
      }
    });
    var signinEmailInput = document.getElementById("signin-email-input");
    var signin = document.getElementById("signin-btn");
    signinEmailInput.addEventListener("input", function() {
      if (!isAllSigninInputsValid()) {
        signin.setAttribute("disabled", "disabled");
      } else {
        signin.removeAttribute("disabled");
      }
    });
    var signInPasswordInput = document.getElementById("signin-password-input");
    signInPasswordInput.addEventListener("input", function() {
      if (!isAllSigninInputsValid()) {
        signin.setAttribute("disabled", "disabled");
      } else {
        signin.removeAttribute("disabled");
      }
    });
    function isAllInputsValid() {
      return emailInput.value.length != 0 && /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(emailInput.value) && nameInput.value.length != 0 && passwordInput.value.length > 6;
    }
    function isAllSigninInputsValid() {
      return signinEmailInput.value.length != 0 && /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(signinEmailInput.value) && signInPasswordInput.value.length > 6;
    }
</script>
</body>
</html>
